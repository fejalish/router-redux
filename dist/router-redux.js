!function(a,b){"object"==typeof exports&&"undefined"!=typeof module?b(exports):"function"==typeof define&&define.amd?define(["exports"],b):b(a.lib=a.lib||{})}(this,function(a){"use strict";function b(a){if(null===a||void 0===a)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(a)}var c=Object.assign||function(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c)Object.prototype.hasOwnProperty.call(c,d)&&(a[d]=c[d])}return a},d="@@router-redux/ROUTE_CHANGE",e="@@router-redux/SET_NEXT_ROUTE",f="@@router-redux/INITIAL_ROUTE_RESOLVED",g="@@router-redux/ROUTE_ERROR",h="@@router-redux/HISTORY_PUSH_STATE",i="@@router-redux/HISTORY_REPLACE_STATE",j="@@router-redux/HISTORY_GO",k="@@router-redux/HISTORY_BACK",l="@@router-redux/HISTORY_FORWARD",m=function(a){return!!a&&0===a.indexOf("@@router-redux/HISTORY")},n=function(a){var b=a.href.replace(a.origin,"");return b.split("?")[0]},o=function(a){var b=a.href.replace(a.origin,"");return b.split("?")[1]?b.split("?")[1]:""},p=function(a){return{type:e,payload:a}},q=function(a){return{type:d,payload:a}},r=function(a){return{type:g,payload:!a||a}},s=function(){return{type:f}},t=function(a){return{type:h,payload:a}},u=function(a){return{type:i,payload:a}},v=function(a){return{type:j,payload:a}},w=function(){return{type:k}},x=function(){return{type:l}},y=function(a){return!(!a||!a.routing)||(console.error("You must register router-redux's reducer as `routing` key."),null)},z=function(a){return y(a)&&a.routing.current},A=function(a){return y(a)&&a.routing.last},B=function(a){return y(a)&&a.routing.next},C=function(a){return y(a)&&a.routing.routeError},D=function(a){return y(a)&&a.routing.isInitialRouteResolved},E=/(:+[^\/?]*)/g,F=function(a){return a=a.replace("/","/").replace(E,"([^/?]*/?)"),new RegExp("^"+a+"$")},G=function(a,b){if(!a||!b)return null;b=b.replace(/(\?.*$)/,""),b=b.replace(/(#+.*$)/,"");var c=b.match(F(a));if(c&&a.match(E)){var d=function(){var b={};return a.match(E).forEach(function(a,d){return c[d+1]?(a=a.replace(":",""),void(b[a]=isNaN(c[d+1])?c[d+1]:Number(c[d+1]))):null}),{v:Object.keys(b).length?b:null}}();if("object"==typeof d)return d.v}return c?{}:null},H=Object.prototype.hasOwnProperty,I=Object.prototype.propertyIsEnumerable,J=Object.assign?Object.assign:function(a,c){for(var d,e,f=b(a),g=1;g<arguments.length;g++){d=Object(arguments[g]);for(var h in d)H.call(d,h)&&(f[h]=d[h]);if(Object.getOwnPropertySymbols){e=Object.getOwnPropertySymbols(d);for(var i=0;i<e.length;i++)I.call(d,e[i])&&(f[e[i]]=d[e[i]])}}return f},K={},L=function(){return J({},K)},M=function(a){for(var b=Object.keys(L()),c=0;c<b.length;c++){var d=b[c];if(G(d,a))return d}return null},N=function(a){var b=arguments.length<=1||void 0===arguments[1]?"":arguments[1],c=M(a),d=G(c,a);return{path:a,route:c,params:d,query:b}},O=function(a){return function(b){var c=a.dispatch,d=a.getState,e=L();return(!b||b instanceof Error)&&(c(r(b)),e.Error?e.Error({dispatch:c,state:d()}):console.warn("You should register router.onError to handle this routing error. data =",b),!0)}},P=function(a){var b=a.dispatch,d=a.getState,e=O(a);K={},requestAnimationFrame(function(){b(q(N(n(location),o(location))));var a=z(d())&&z(d()).path,c=M(a);K[c]&&K[c].onEnter&&(2==K[c].onEnter.length?K[c].onEnter({dispatch:b,state:d()},function(){var a=arguments.length<=0||void 0===arguments[0]||arguments[0];b(s()),e(a)}):K[c].onEnter({dispatch:b,state:d()}))});var f=function(a){K.Error=a},g=function(a,b){K[a]=K[a]||{},K[a]=c({},K[a],{onEnter:b})},h=function(a,b){K[a]=K[a]||{},K[a]=c({},K[a],{onLeave:b})},i=function(a){b(q(N(n(location),o(location))));var c=z(d())&&z(d()).path,f=M(c);K[f]&&K[f].onEnter&&(2==K[f].onEnter.length?K[f].onEnter({dispatch:b,state:d()},function(){var a=arguments.length<=0||void 0===arguments[0]||arguments[0];b(s()),e(a)}):K[f].onEnter({dispatch:b,state:d()}))};window.addEventListener("popstate",i);var j=function(){return window.removeEventListener("popstate",i)};return{onEnter:g,onError:f,onLeave:h,destroy:j}},Q=function(a,b){return b.type===h?a.pushState(null,null,b.payload):b.type===i?a.replaceState(null,null,b.payload):b.type===j?a.go(b.payload):b.type===k?a.back():b.type===l&&a.forward(),c({},b,{payload:N(n(location),o(location))})},R=function(a){return function(b){return function(c){var d=a.dispatch,e=a.getState,f=O(a),g=z(e())&&z(e()),j=M(g&&g.path),k=window.history;if(!m(c.type))return void b(c);var l=g.query?g.path+"?"+g.query:g.path;if(c.type!==h&&c.type!==i||l!==c.payload){var n=L(),o=c.payload,q=M(o);if(n[j]&&n[j].onLeave&&n[j].onLeave({dispatch:d,state:e()}),n[q]&&n[q].onEnter){var r=D(e());if(!r&&b(s()),b(p(N(o,o.split("?")[1]))),2==n[q].onEnter.length)return void n[q].onEnter({dispatch:d,state:e()},function(){var a=arguments.length<=0||void 0===arguments[0]||arguments[0];f(a)||(c=Q(k,c),b(c))});n[q].onEnter({dispatch:d,state:e()})}c=Q(k,c),b(c)}}}},S={current:null,last:null,next:null,isInitialRouteResolved:!1,routeError:!1},T=function(){var a=arguments.length<=0||void 0===arguments[0]?S:arguments[0],b=arguments[1];return b.type===d||m(b.type)?c({},a,{current:b.payload,next:null,routeError:null,last:a.current}):b.type===g?c({},a,{next:null,routeError:b.payload}):b.type===e?c({},a,{next:b.payload}):b.type===f?c({},a,{isInitialRouteResolved:!0}):a},U=R,V=T,W=z,X=A,Y=B,Z=C,$=D,_=G,aa=t,ba=u,ca=v,da=w,ea=x;a.routerMiddleware=U,a.routerReducer=V,a.getCurrent=W,a.getLast=X,a.getNext=Y,a.getRouteError=Z,a.getIsInitalRouteResolved=$,a.match=_,a.push=aa,a.replace=ba,a.go=ca,a.back=da,a.forward=ea,a.default=P,Object.defineProperty(a,"__esModule",{value:!0})});